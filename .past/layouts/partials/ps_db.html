{{ $psData := .Site.Data.ps_db.ps_db }}
{{ $style := resources.Get "css/ps_db.css" | resources.Minify }}
{{ $script := resources.Get "js/ps_db.js" | resources.Minify }}

<link rel="stylesheet" href="{{ $style.RelPermalink }}">
<script src="{{ $script.RelPermalink }}"></script>

{{/* ë‚ ì§œ ë°ì´í„°ë¥¼ JavaScriptë¡œ ì „ë‹¬í•˜ê¸° ìœ„í•œ ìŠ¤í¬ë¦½íŠ¸ */}}
<script>
  window.psData = [
    {{ range $psData }}
    {
      site: "{{ .site }}",
      title: "{{ .title }}",
      id: {{ if .id }}{{ .id }}{{ else }}null{{ end }},
      rank: "{{ .rank }}",
      link: "{{ .link }}",
      tags: {{ if .tags }}[{{ range .tags }}"{{ . }}",{{ end }}]{{ else }}[]{{ end }},
      solved: {{ if .solved }}{{ with (first 1 .solved) }}{{ $latest := index . 0 }}{{ $date := time $latest.date }}{{ $now := now }}{{ $diff := $now.Sub $date }}{{ $days := int (div $diff.Hours 24) }}{{ $days }}{{ end }}{{ else }}null{{ end }}
    },
    {{ end }}
  ];
</script>

{{/* ë°ì´í„° ì •ë ¬ì„ ìœ„í•œ í•¨ìˆ˜ ì •ì˜ */}}
{{ define "getDays" }}
  {{ $value := . }}
  {{ if eq $value "-" }}
    {{ 999999 }}
  {{ else if eq $value "ì˜¤ëŠ˜" }}
    {{ 0 }}
  {{ else }}
    {{ $days := replaceRE "[^0-9]" "" $value }}
    {{ int $days }}
  {{ end }}
{{ end }}

<table class="ps_db_table" id="psTable">
  <thead>
    <tr>
      <th data-sort="site">ì‚¬ì´íŠ¸</th>
      <th data-sort="title">ë¬¸ì œ</th>
      <th data-sort="rank">ë‚œì´ë„</th>
      <th data-sort="tags">íƒœê·¸</th>
      <th data-sort="solved">í’€ì´ì¼</th>
      <th data-sort="review">ë¦¬ë·°</th>

      {{/*  <th>ë³µìŠµ í•„ìš”</th>
      <th>í’€ì´ ê¸°ë¡</th>  */}}

    </tr>
  </thead>
  <tbody>
    {{ range $psData }}
    <tr>
      <td>{{ .site }}</td>
      <td><a href="{{ .link }}" target="_blank">{{ .title }}</a></td>
      <td><span class="rank" data-rank="{{ .rank }}">{{ .rank }}</span></td>
      <td>{{ if .tags }}{{ delimit .tags ", " }}{{ else }}-{{ end }}</td>
      <td class="solved-date" data-days="{{ if .solved }}{{ with (first 1 .solved) }}{{ $latest := index . 0 }}{{ $date := time $latest.date }}{{ $now := now }}{{ $diff := $now.Sub $date }}{{ $days := int (div $diff.Hours 24) }}{{ $days }}{{ end }}{{ else }}-1{{ end }}"></td>

      {{/*  <td>{{ if .review_required }}âœ…{{ else }}âŒ{{ end }}</td>
      <td>
        {{ range .solved }}
        <p>{{ .date }} ({{ .time }}ë¶„) - {{ .note | markdownify }} {{ if .sole_solved }}ğŸ”¥{{ end }}</p>
        {{ end }}
      </td>  */}}
      <td>
        {{ if .id }}
          {{ $page := $.Site.GetPage (printf "ps/bj%d" .id) }}
          {{ if $page }}
            <a href="{{ $page.RelPermalink }}" target="_blank">ğŸ“„ ë¦¬ë·° ë³´ê¸°</a>
          {{ else }}
            âŒ
          {{ end }}
        {{ else }}
          âŒ
        {{ end }}
      </td>

    </tr>
    {{ end }}
  </tbody>
</table>
